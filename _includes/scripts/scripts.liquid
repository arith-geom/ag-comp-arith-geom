<!-- Vendor JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.3.2/mdb.umd.min.js"></script>

<!-- Lunr.js for search (with integrity for security) -->
<!-- Option 1: CDN version (current) -->
<script src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
        integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
        crossorigin="anonymous"
        defer></script>
<!-- Option 2: Self-hosted version (uncomment to use local copy for better performance under high load) -->
<!-- <script src="{{ '/assets/js/lunr.min.js' | relative_url }}" defer></script> -->
<script>
  // Ensure navigation helpers are available to search.js in case it loads first
  if (!window.prefixBase) {
    window.__BASEURL__ = window.__BASEURL__ || '';
    window.prefixBase = function(path) {
      if (!path) return path;
      if (/^https?:\/\//.test(path)) return path;
      if (window.__BASEURL__ && path.startsWith(window.__BASEURL__ + '/')) return path;
      if (path.startsWith('/')) return (window.__BASEURL__ || '') + path;
      return path;
    };
  }
  // Patch anchor navigation for root-relative hrefs
  (function(){
    document.addEventListener('click', function(e){
      const a = e.target.closest('a[href^="/"]');
      if (!a) return;
      const href = a.getAttribute('href');
      if (!href || /^https?:\/\//.test(href)) return;
      a.setAttribute('href', window.prefixBase(href));
    }, true);
  })();
  // Patch <img src="/..."> and other asset URLs after DOMContentLoaded
  document.addEventListener('DOMContentLoaded', function(){
    const fixAttr = (el, attr) => {
      const v = el.getAttribute(attr);
      if (v && v.startsWith('/') && !/^https?:\/\//.test(v)) {
        el.setAttribute(attr, window.prefixBase(v));
      }
    };
    document.querySelectorAll('img[src^="/"], script[src^="/"], link[href^="/"], a[href^="/"], source[srcset^="/"]').forEach(el => {
      const tag = el.tagName;
      if (tag === 'A' || tag === 'LINK') fixAttr(el, 'href');
      else if (tag === 'SOURCE') fixAttr(el, 'srcset');
      else fixAttr(el, 'src');
    });
  });
</script>
<script src="{{ '/assets/js/search/search.js' | relative_url }}"></script>



<!-- Bootstrap Table of Contents -->
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js"></script>
<script>
  $(function () {
    var navSelector = '#toc';
    var $myNav = $(navSelector);
    Toc.init($myNav);
    $('body').scrollspy({
      target: navSelector
    });
  });
</script>

<!-- Load Common JS -->
<script defer src="{{ '/assets/js/core/common.js' | relative_url }}" type="text/javascript"></script>

<!-- Enhanced Theme Switcher - DISABLED (using simple head script instead) -->
<!-- <script src="{{ '/assets/js/theme-switcher.js' | relative_url }}"></script> -->



<!-- Performance Monitor (for high-load scenarios) -->
<script src="{{ '/assets/js/core/performance-monitor.js' | relative_url }}"></script>

<!-- Debug script -->
<script src="{{ '/assets/js/debug.js' | relative_url }}"></script>

<!-- Page Specific JS -->
{% if page.scripts %}
  {% for script in page.scripts %}
    <script defer src="{{ script | relative_url }}" type="text/javascript"></script>
  {% endfor %}
{% endif %}
